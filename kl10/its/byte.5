.TOC	"BYTE GROUP -- IBP, ILDB, LDB, IDPB, DPBôCE	.DCOø‘FŠw133:	R,		J/IBP		;OR ø1%B¡ñ¢˜³i:	RW,		J/ILDB		÷pàÎOT USE RPW BECAUúqPO FPD
	R,		J/LDøCE	¥W,		J/IDPB
	R,ñ"e/‰PB
	.UCODE

;ALL FIVE INSTRUCTIONS OFô$I§ôéO«P ARE CALLED WITH THE BYTE POINTER
;IN THE AúK ƒLL INSTRUCTIONSôäA¥ø¨!Ï›MON SUBROUú’gE§, SO THAT
;THEôX/c1 INTERFACE AND STRING MAû( Ì§O USE THESE SUBROUTINES
ñ¢É…P OR ADJBPñ¢É…ú$ÆAAC#0, ADJBP OTHø´«É§ø£E;AùiEAWITH THE Bø4â ¡ùògT‹R IN AR

;IBP÷BiË¡ AC#0			;IS THIúh$Â¡ OR Aø’¡P
.IF/ADJBP
=0öŠ“BP1:	T0_AR,BR/AúK‰;SAVE POINTER FùôA‰JBP
		SC_S,AR_0S,CALL,J/GETSCñ.ÐG‹T BYTø¨)ÉµE
.ENDIF/ADJBP
=001
IBú	…úKàÒYP_P-SõàÌ™õÓV	;NEW P UNLESS OúÑiF™ùõÆŠ	SKP SCAD0,J/IBPS
.ù1—Á‰JBP
	BR/AR,AR_BR,J/ADJBP		;HOLD S IN BR AND ù´FŠ]ENDIFõðbJ…P
=101	FIN STOúQVIAFETCHõ’—ÎŸP		;IBP DOùÑFŠ{

=00*000
ILø	…R/AR,P_P-S,BYTEô$Ó¡,		;START IBP
		CALL.M,J/IBPS		;AND CALL SUBR
=100
LDB:	ARX_AR,SC_PõàÌ™,J/BYú‘`‰wBEGINô` ‡OMPUTATION
	SCûñ¢«§C,CALù‹%/™DB1		;SC_P+S WHILE LOADING AR
=111	AC0_AR,CLR FPDõ’PF‹TCH,J/NOP	;DONEñ¢ž
=00*000îñRbP…:	BR/AR,P_úi¬…YTE DISP,	ñ.éÔƒúUI…P
		øpfL]ù«%/“øT)=100îñQ(Bu	ARX_AR,SCûôCƒLL,J/øVjEƒñ.áÏ›PUTE ø±£E‡ú’kEABYTE ø1"RñB`Ò¿AC0,Tù3b¯gú‹)Ã¿#-SC,#/36.õ‚]ÃŸMPUTEôÛ-¡ñ¢„‰‡ø3&,§ùtS‡AD0,J/DPB1ñ.áÁ™L DEPùôäÔŸR
=1ö,FŠ…øÒg:FIN STORE,ù(#E©ør‰wø“çE=
=öEC™úQ¨Du	CLR øÔ",•õñ¤Î“ñ"D»‡ø3“ÔAø“ÐT‘ù4ÐUTIL Sú“éEAøsæÐ™øµ"	J/FINI			ñ.äE¥ø¨#RŸù¨!L—O/BLKI PIîñCTŸøbQIøt¢Í‹NT BYTE POINTERôêÂ¥ùõjIø¨†ŠñNêH“S SUBúSêÔ“NE IS CALLED BY THE ù3©Ô¥UCTIOùÔÐI™ø– “DPB AúcE;¯ø³& ƒS THE MICRùðçÄ‹øˆ°_11 INTERFAøqPHƒNDLER.
;Cø3& ¯ITH Bû5" ‰ISP TESTING FPD AND SIGN OF P-S
;[TIME=2+2(Bú'ÖLO)]

=010			ñ"]Â¥12 IRELEVANT
IøT)ºSTORE,RETURN4		ñ.éÉ›PLE, NO OVø´£LŸW
	FE_#,#õìÛ.YGEN AR+1,TIME/2T,	;HERE IøÈ'Ö¥FLO OF WORD
		ARX_AR,J/NXTWRD
	AR_BR,RETURN4			;FPD WAS SET, REúu'Ò‹ AR
	AR_BR,RETURN4			; AND CONVERTô' ™øO¥ DPB
				ñ.êE§T BR1öH'Î™Y
NXTWRD:ñ0i_ƒR+1,Pûñ¢­§,STORE,
		TIME/2T,RETURNöƒE
.TOC	"BYTE EFFECTIúÑPA‰ø”¢Ó§ôkA™ú°jO¥"

;ENTER WITH POINTER IN AR, ARX, ANDô©;RETURN1 WITH (EA) LOADING INTO AR ø3¢ ƒRX,
;FPD SET, P IN SC, AND S IN FE
;[TIME=4+1(INDEXEDõ*ß¨“NDIREøuÝ
BYú‘`ºMEM_AR,FE_úk)Å©ô¨DY		;PUT AWAY UPDATED POINTø´†Š	EA MùñD“SP		;øµ ÌABP ADDR
=00
BøÑjC‘:	VMA_ARX,øVjEAúQ`ÄYRETURùÌD»§TART DATA FETCHñ¢„Ö›A_ARX+XR,BYTE Rø°b,¥ETURNö"]Á‰DRESSôi “NDEXEøƒE	EN ARû!Y©E INDRCT,J/BYTEù"]ÄŸ INDIúQaÔ	GENôiXWXR,BYTE INDRCT,ùKáY©EI	;IùÑ$Ò‹CT INø‘lE‰!!!

BYTEI:	ARX_MEM,SKP INTRPT		;úðdÔAFOR IùÑ$Ò‹CT WORD
=0	EA ù³â ‰ISP,Jõð£E©CH		;PROCEED INôbD¥ EVAL
	SR DISP,J/CLEAN		ñ.äÎ©ERRUPTED, øs"Áôh ƒS REQôñŠ.TOC	"LOAD BYTE SUBROUTINE"
;ø³ªE¥ WITH S INô¢¬Aú
é “ùÈ)ÃY AND ø4LŸAD INô)ORESS
;SKP INTERRUPT AT EùÕ)YAIS OPTIONAL
;RETURN2 WITù!Y©E RIGHT JUSTIFIø±Iôi;[TIME=7]
=0
LDB1:	AR_MEM,SCûèÖÓ‡,#/36.,SKPôáÁ‰ö»göËTPWújFŠ	TIME/3T,J/LDB2ñ¢„Á¥_MEM,SR DISP,J/øs"Áñ"]È‹RE IF INTEúTªÐ© PENDING

=0îñS"Be÷B`Ò±_SHIFT,AR_0S,SCûñ¢¬•õôäIT	;BYTE IN ARX ùV ¥EADY TO SHù1ª	ARX_AR,AR_0S,			;P+S > 36, PUT BYTø¨$ÎAø4¬ ‘ù#E	úpïÆ‹+SC,SùtS‡ø1	wø1%U§úˆ) ƒND SHù1ª …YTE

;PUT BYTø¨$Î©O AR úRcÈ©õ²ªÓ©IFIEDñ¢ ©ùi “NSTRUCTION ALSO CALLø±A™ùó¢ ƒúh  §UBROUú’gEñCE=añ¢©È“FT:	AúWéÈ“FT,REú•iNe		;REú•iNAWITH BYTE IN ARñ¢„Ò‹TURN2				;øVjEAúði ŸFF THø¨"Î‰õˆ)E©ú´§ ƒR=0
ñ¢†Š]TOC	"ø‘hO§IT BYú‘PS«BROUTINE"
;ENTER WITH BYú‘PR“GHT JUSTIFIED IN AR, POINú‘i “N BR,ñ¢ § IN FE, 36-P INôá¬Aø3¢ ™ùðb ƒR-ARX STARTED
; SKP IF P>36
;RETURN3 WITH FINAL STOREôg ¡ROGREútÆŠw[TIME=11]

=0
DPB1:	MQ_AR,AúWæÅ›,ARX_MEM,	ñ.ãÅ©ôçÒ‰ô' ¥OTATE 36-P
		GEN FEõ´á¬©ù3b¯gú‹»‡OMPUTø¨)­Q36-P)
		SKP SCø1,•/DPB2	;CHEørÐT‘AT P+úo¶	MB WAIT,RETURN3			;P>36, STORE NOTHINGñ¢†Š{0
DPøL	E_SC	ñ"D»¡+S>36õˆ)ßgöËh	ARX_úr$Æ©,AR_MQ,SC_FE,		÷piXAHAS P,X,S
		FE_#-SC,#/72.		;SC_S, øÑo·e-(36-ú
^³m+P
	úpï£[úpÖ#_öm—		;SC_öm–ÓA(KNOWùÈL‹. P)
	AR_SHIFT,ARX_SHIFTõ‚D»§,P,XîñBDÓ‡ûñ¢­§øbD»§C_(36õt­Q36-S)=P+S
	AR_SHIFT,STORE,RETú´§3	;DONE, STORE Iúˆ!A‡K
.TOC	"ADJBP"
;HERE FOR ADJUST BYTE POINTER (IBP WITH NON-ZERO AC)
; BYTE SIZE (S) IS RIGHT ADJUSTED IN BR AND MQ
; FULùˆ(O“NTER IS IN AR, ø3¢ §AVED IN T0ñ¢†Š]IF/ADJBP
ñ¢ Ä•øT	§øwè,ƒR+ARX+MQ_0õÓV	÷qâÔAúE	SKP BúH"Ñ	;CHEørÐS“ZE ISô§Î[ZEROîñCE=a0	BRXõðiXYúéÃYCALL.M,J/Sù6"I­	;DIVù1" ¡ô¬ §ñ¢„Á¥ûõ,•õòcS©ø0Ä‰÷sçÐ§õˆ)½a, RETURN UùÐfT‹úQb ¡ùògT‹R
	T1_AR,ø4¯°§,ARX_öÖ	;SAVE P/SîñBDÓ‡_FE-SøbD»g6-P IùÈ)ÃñOFŠ{ö
„Ð¿úpÖM£ûìMYCALL.M,J/SIXDIV	;36-P IN AR0-5
	AR_AR+T1,SKPôb E		;(úé©W(36-P/S)=BYTES/úóéD=0	Iô¢Ô‡H,J/NODIVD		;ABùôª,ABYTES/WORD=0
	úŒoÁ¥õ©/ƒúK Ò¿ARX		;SAVE BYTES/WORD, READY TO
					; DIVIDE BY ù5ŠúŒ¯Á¥,AR_MQ			;SAVE úQfÁ“N(36-P/S), GET õÛ-¡õ+é	AR_AúJ Ãa,AD/A+B,ARL/AD,	;ADJUSTMENT IN AR
		ARXõshßaõÓFŠñNáÏ›újEAQUOTIENT QôgDAREMAINDER úH'ÆAADJUSTMENTõê!Y©ES/WOúQ; SUCù*HƒT ADJUSTMENT=Q*(BYTES/WORD)+R, 1 .LE. R .LE. (BYTES/WORøŠFŠw SINCE ADJUSTMENT IS CALCULATED RELø5$Ö‹ TO Lø±ª-›OST Bû5" ŸF
; ø(+Ï¥ø‹T‘IS GIVES Q AS THE NUMBER OF WORDS BY WHIørTŸ INDEû*H‹
; BYTE POINTEúKAD R AS THEôªÍ…ø´Oô¬Ô‹S FROM THE LEFTôã ©HE
; WORD.  MUù•$Ð™û2gGAR BY ú’" …û5" §IZE WILL Gù5¢ ©HE NUMBER OF BITS
; FROMô$EALEFTMùôê …YTE, AND ADDING REMAIN(36-P/S) WILL GIVE NUMBER
; OF BITS FROM BIT 0.  FINALLY, WE MUST SUBTRACT THIS FROM 36 TO GET
; THE CORRECT P FIELD, WHICH IS ALWAYS RELATIVE TO THE RIGHT EDGE OF
; THE WORD.

=100	AC0_AR,SC_1,CALL,J/DIV2		;DO THE BASIC DIVIDE
=110	ARX_-BRX,FE_#,#/-4,J/ADJD1	;NEG QUO ==> NEG REMAIN
	ARX/MQ,SKP AR NE,FE_#,#/-4	;POS QUO.  IS REMAIN .GT. 0?
=0
ADJD1÷B`Ò¿AR+T1,J/ADJD2		;INCREASE REMAIN TO MEET CONSTRAINT
	BR/AR,AR_ARX (ADX),		;REMAIN IN RANGE,
		ARL+ARX_0.M,J/ADJD3	; QUOTIENT TO ARR

ADJD2:	BR/AR,AR_ARX-1,			;HOLD UPDATED REMAINDER,
		ARL+ARX_0.M		; GET CORRESPONDING QUOTIENT
ADJD3:	AR_AR+T0,INH CRY18,		;ADD Q TO Y OF POINTER,
		BRXõðiX		;CLR BRX

=00*	AC0_AR,AR_0S,SC_S,CALL,J/GETSC	;SAVE UPDATED Y, GET SIZE
	MQ_AR,AR_T2,CLR ARX,		;M'IER IS S, GET REMAIN(36-P/S)
		CALL,J/MULREE		;COMPUTE (R*S)+REMAIN(36-P/S)
=11*	AR_ARX*2,I FETCH		;PUT THAT IN AR0-5
	SC_P-#,#/36.,AR_AC0
	P_-SC,J/STAC			;THAT'S NEW P, DONE

.ENDIF/ADJBP
;SUBROUTINE TO GET CONTENTS OF SC RIGHT ALIGNED IN AR
;[TIME=6]

GETSC:	AR0-8_SC			;PUT SC INTO AR
GETEXP:	ARX_AR,SC_#,#/9.,J/SHIFT	;HERE WITH DATA IN AR0-8


;SUBROUTINE FOR SHORT DIVISION, BR KNOWN POSITIVE
; CALL WITH MQ CLEAR, DIVISOR RIGHT-ALIGNED IN BR, AND DIVIDEND
;	IN AR0-5 (OR LEFT-ALIGNED IN ARX IF ENTERING AT SDIV)
; RETURN QUOTIENT IN AR AND MQ, REMAIN IN ARX
;[TIME=22+3(RESTORE REQ'D)]

;TO IMPROVE ADJBP PERFORMANCE, INSERT THE INSTRUCTION SHOWN BELOW
; (SIXDZ), AND CHANGE THE CALLS TO SIXDIV TO "SKP SCAD NE,J/SIXDZ"
;=0
;SIXDZ:	AR_0S,ARX_0S,FE_#,#/36.,RETURN2	;HERE IF DIVIDEND IS ZERO

SIXDIV:	ARX_AR,AR_0S,FE_#,#/4,J/SDIV-
=0*0
SDIV:	DIVIDE,AR_2(AR+BR),ARX/ADX*2,J/SDIV
SDIV-:	DIVIDE,AR_2(AR-BR),ARX/ADX*2,J/SDIV
	DIVIDE,AR_AR+BR,J/SDIVR		;NO SHIFT ON FINAL STEP
	DIVIDE,AR_AR-BR
=1*0
SDIVR:	AR_AR+BR			;NO CRY0 MEANS RESTORE REQ'D
	ARX_AR,AR_MQ,			;RETURN QUO IN AR, REMAIN IN ARX
		FE_#,#/36.,RETURN2
